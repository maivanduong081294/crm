jQuery("document").ready(function(e){e(document).on("click",".upload-btn",function(t){t.preventDefault();var i=e(this),a=wp.media({title:"Upload Image",multiple:!1}).open().on("select",function(){var e=a.state().get("selection").first().toJSON().url;i.siblings(".upload-field").val(e),e&&(i.siblings(".remove-upload-btn").show(),i.siblings(".upload-image").html('<img src="'+e+'" style="margin-top: 15px;" />'))})}),e(document).on("click",".remove-upload-btn",function(t){t.preventDefault();var i=e(this);i.siblings(".upload-field").val(""),i.siblings(".upload-image").html(""),i.hide()}),e(document).on("click",".repeater-field-add",function(){var t=e(this),i=t.parents(".repeater-field").children(".repeater-button-add").children(".repeater-args").val(),a=t.parents(".repeater-field").children(".repeater-field-list").children().length;if(t.parent(".repeater-field-item-button").length){a=t.parents(".repeater-field-item").index();var r=t.parents(".repeater-field-list"),n=0,d=t.parent().data("type"),l=!1;r.children().each(function(){var t=e(this).attr("data-item");if(t>=a){var i=n+1;l||(e(this).parents(".repeater-field").children(".repeater-field-list").children().eq(n).find(".wp-editor-area").each(function(){tinyMCE.execCommand("mceRemoveEditor",!1,e(this).attr("id"))}),l=!0),e(this).parents(".repeater-field").children(".repeater-field-list").children().eq(i).find(".wp-editor-area").each(function(){tinyMCE.execCommand("mceRemoveEditor",!1,e(this).attr("id"))});var r=e(this).html(),s=d+"-"+t;s=new RegExp(s,"gi");var c=d+"-"+i;r=r.replace(s,c),e(this).html(r),e(this).find("[name]").length&&e(this).find("[name]").each(function(){var a=e(this).attr("name");a=a.split(t+"]")[1],e(this).attr("name",d+"["+i+"]"+a),e(this).hasClass("wp-editor-area")&&(tinyMCE.execCommand("mceAddEditor",!1,e(this).attr("id")),quicktags({id:e(this).attr("id")}))}),e(this).attr("data-item",i)}n++})}e.ajax({url:ajax_object.url,type:"post",data:{action:"repeater_field_add",args:i,key:a},beforeSend:function(){},success:function(i){if(t.parent(".repeater-field-item-button").length){r.children().eq(a).before(i),r.children().eq(a).find(".wp-editor-area").each(function(){tinyMCE.execCommand("mceRemoveEditor",!1,e(this).attr("id")),tinyMCE.execCommand("mceAddEditor",!1,e(this).attr("id")),quicktags({id:e(this).attr("id")})});var n=0;r.children().each(function(){e(this).data("item")>=a&&e(this).find(".repeater-field-item-title span").text("#"+(n+1)),n++})}else t.parents(".repeater-field").children(".repeater-field-list").append(i),t.parents(".repeater-field").children(".repeater-field-list").children().eq(a).find(".wp-editor-area").each(function(){tinyMCE.execCommand("mceRemoveEditor",!1,e(this).attr("id")),tinyMCE.execCommand("mceAddEditor",!1,e(this).attr("id")),quicktags({id:e(this).attr("id")})})}})}),e(document).on("click",".repeater-field-remove",function(){var t=e(this),i=(t.parents(".repeater-field-item").index(),0),a=t.parents(".repeater-field-list"),r=t.parent().data("type"),n=!1;a.children().each(function(){var a=e(this).attr("data-item");if(n){e(this).parents(".repeater-field").children(".repeater-field-list").children().eq(i).find(".wp-editor-area").each(function(){tinyMCE.execCommand("mceRemoveEditor",!1,e(this).attr("id"))});var d=e(this).html(),l=r+"-"+a;l=new RegExp(l,"gi");var s=r+"-"+i;d=d.replace(l,s),e(this).html(d),e(this).find("[name]").length&&e(this).find("[name]").each(function(){var t=e(this).attr("name");t=t.split(a+"]")[1],e(this).attr("name",r+"["+i+"]"+t),e(this).hasClass("wp-editor-area")&&(tinyMCE.execCommand("mceRemoveEditor",!1,e(this).attr("id")),tinyMCE.execCommand("mceAddEditor",!1,e(this).attr("id")),quicktags({id:e(this).attr("id")}))}),e(this).attr("data-item",i),e(this).find(".repeater-field-item-title span").text("#"+(i+1))}a==t.parents(".repeater-field-item").data("item")?(n=!0,e(this).parents(".repeater-field").children(".repeater-field-list").children().eq(i).find(".wp-editor-area").each(function(){tinyMCE.execCommand("mceRemoveEditor",!1,e(this).attr("id"))}),t.parents(".repeater-field-item").remove()):i++})}),e(document).on("click",".repeater-field-open",function(){e(this).toggleClass("active"),e(this).parents(".repeater-field-item-header").siblings(".repeater-field-item-content").slideToggle()})});