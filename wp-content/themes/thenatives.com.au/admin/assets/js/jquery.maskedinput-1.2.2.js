!function(e){var t=(e.browser.msie?"paste":"input")+".mask",n=void 0!=window.orientation;e.mask={definitions:{9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"}},e.fn.extend({caret:function(e,t){if(0!=this.length){if("number"==typeof e)return t="number"==typeof t?t:e,this.each(function(){if(this.setSelectionRange)this.focus(),this.setSelectionRange(e,t);else if(this.createTextRange){var n=this.createTextRange();n.collapse(!0),n.moveEnd("character",t),n.moveStart("character",e),n.select()}});if(this[0].setSelectionRange)e=this[0].selectionStart,t=this[0].selectionEnd;else if(document.selection&&document.selection.createRange){var n=document.selection.createRange();e=0-n.duplicate().moveStart("character",-1e5),t=e+n.text.length}return{begin:e,end:t}}},unmask:function(){return this.trigger("unmask")},mask:function(a,r){if(!a&&this.length>0){var i=e(this[0]),o=i.data("tests");return e.map(i.data("buffer"),function(e,t){return o[t]?e:null}).join("")}r=e.extend({placeholder:"_",completed:null},r);var c=e.mask.definitions,o=[],s=a.length,l=null,u=a.length;return e.each(a.split(""),function(e,t){"?"==t?(u--,s=e):c[t]?(o.push(new RegExp(c[t])),null==l&&(l=o.length-1)):o.push(null)}),this.each(function(){function i(e){for(;++e<=u&&!o[e];);return e}function f(e){for(;!o[e]&&--e>=0;);for(var t=e;t<u;t++)if(o[t]){b[t]=r.placeholder;var n=i(t);if(!(n<u&&o[t].test(b[n])))break;b[t]=b[n]}v(),g.caret(Math.max(l,e))}function h(e){for(var t=e,n=r.placeholder;t<u;t++)if(o[t]){var a=i(t),c=b[t];if(b[t]=n,!(a<u&&o[a].test(c)))break;n=c}}function d(e,t){for(var n=e;n<t&&n<u;n++)o[n]&&(b[n]=r.placeholder)}function v(){return g.val(b.join("")).val()}function m(e){for(var t=g.val(),n=-1,a=0,i=0;a<u;a++)if(o[a]){for(b[a]=r.placeholder;i++<t.length;){var c=t.charAt(i-1);if(o[a].test(c)){b[a]=c,n=a;break}}if(i>t.length)break}else b[a]==t[i]&&a!=s&&(i++,n=a);return!e&&n+1<s?(g.val(""),d(0,u)):(e||n+1>=s)&&(v(),e||g.val(g.val().substring(0,n+1))),s?a:l}var g=e(this),b=e.map(a.split(""),function(e,t){if("?"!=e)return c[e]?r.placeholder:e}),p=!1,k=g.val();g.data("buffer",b).data("tests",o),g.attr("readonly")||g.one("unmask",function(){g.unbind(".mask").removeData("buffer").removeData("tests")}).bind("focus.mask",function(){k=g.val();var e=m();v(),setTimeout(function(){e==a.length?g.caret(0,e):g.caret(e)},0)}).bind("blur.mask",function(){m(),g.val()!=k&&g.change()}).bind("keydown.mask",function(t){var a=e(this).caret(),r=t.keyCode;return p=r<16||r>16&&r<32||r>32&&r<41,a.begin-a.end==0||p&&8!=r&&46!=r||d(a.begin,a.end),8==r||46==r||n&&127==r?(f(a.begin+(46==r?0:-1)),!1):27==r?(g.val(k),g.caret(0,m()),!1):void 0}).bind("keypress.mask",function(t){if(p)return p=!1,8!=t.keyCode&&null;var n=(t=t||window.event).charCode||t.keyCode||t.which,a=e(this).caret();if(t.ctrlKey||t.altKey||t.metaKey)return!0;if(n>=32&&n<=125||n>186){var c=i(a.begin-1);if(c<u){var s=String.fromCharCode(n);if(o[c].test(s)){h(c),b[c]=s,v();var l=i(c);e(this).caret(l),r.completed&&l==u&&r.completed.call(g)}}}return!1}).bind(t,function(){setTimeout(function(){g.caret(m(!0))},0)}),m()})}})}(jQuery);